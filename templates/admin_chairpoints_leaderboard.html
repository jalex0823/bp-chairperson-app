{% extends "base.html" %}
{% block content %}
<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-trophy"></i> ChairPointsâ„¢ Leaderboard - Full Report</h2>
    <div class="btn-group">
      <button onclick="window.print()" class="btn btn-secondary btn-sm">
        <i class="fas fa-print"></i> Print
      </button>
      <a href="{{ url_for('admin_chairpoints_leaderboard', format='csv') }}" class="btn btn-success btn-sm">
        <i class="fas fa-file-csv"></i> Export CSV
      </a>
      <a href="{{ url_for('admin_analytics') }}" class="btn btn-outline-secondary btn-sm">
        <i class="fas fa-chart-bar"></i> Analytics
      </a>
      <a href="{{ url_for('admin_meetings') }}" class="btn btn-outline-primary btn-sm">
        <i class="fas fa-arrow-left"></i> Back to Meetings
      </a>
    </div>
  </div>

  <!-- Summary Stats -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card bg-warning text-dark">
        <div class="card-body text-center">
          <i class="fas fa-users fa-2x mb-2"></i>
          <h3 class="mb-1">{{ leaderboard|length }}</h3>
          <small>Total Chairpersons</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-success text-white">
        <div class="card-body text-center">
          <img src="{{ url_for('static', filename='img/chairpoint-coin.png') }}" style="width: 48px; height: 48px;" class="mb-2" alt="ChairPoints">
          <h3 class="mb-1">{{ leaderboard|sum(attribute='chair_points') }}</h3>
          <small>Total ChairPoints</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-primary text-white">
        <div class="card-body text-center">
          <i class="fas fa-medal fa-2x mb-2"></i>
          <h3 class="mb-1">{% if leaderboard %}{{ leaderboard[0].chair_points }}{% else %}0{% endif %}</h3>
          <small>Highest Score</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-info text-white">
        <div class="card-body text-center">
          <i class="fas fa-calculator fa-2x mb-2"></i>
          <h3 class="mb-1">{% if leaderboard %}{{ (leaderboard|sum(attribute='chair_points') / leaderboard|length)|round(1) }}{% else %}0{% endif %}</h3>
          <small>Average Points</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Full Leaderboard Table -->
  <div class="card shadow-lg">
    <div class="card-header text-white text-center py-3" style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);">
      <h4 class="mb-0">
        <i class="fas fa-trophy"></i> 
        <strong>Complete ChairPointsâ„¢ Rankings</strong> 
        <i class="fas fa-star"></i>
      </h4>
      <small class="d-block mt-1" style="opacity: 0.9;">All chairpersons ranked by service points</small>
    </div>
    <div class="card-body p-0">
      {% if leaderboard %}
      <div class="table-responsive">
        <table class="table table-hover table-striped mb-0">
          <thead class="table-dark sticky-top">
            <tr>
              <th class="text-center" style="width: 100px;">Rank</th>
              <th style="width: 80px;"></th>
              <th>Chairperson</th>
              <th>BP-ID</th>
              <th>Email</th>
              <th class="text-center">Total Meetings</th>
              <th class="text-center" style="width: 180px;">
                <img src="{{ url_for('static', filename='img/chairpoint-coin.png') }}" style="width: 20px; height: 20px; vertical-align: middle;" alt="ChairPoints"> ChairPointsâ„¢
              </th>
            </tr>
          </thead>
          <tbody>
            {% for chair in leaderboard %}
            <tr class="{% if loop.index <= 3 %}table-warning fw-bold{% endif %}">
              <td class="text-center align-middle">
                {% if loop.index == 1 %}
                  <span class="badge rounded-pill" style="background: linear-gradient(135deg, #FFD700, #FFA500); font-size: 1.2rem; padding: 0.6rem 1rem;">
                    ðŸ¥‡ #1
                  </span>
                {% elif loop.index == 2 %}
                  <span class="badge rounded-pill" style="background: linear-gradient(135deg, #C0C0C0, #A8A8A8); font-size: 1.1rem; padding: 0.5rem 0.9rem;">
                    ðŸ¥ˆ #2
                  </span>
                {% elif loop.index == 3 %}
                  <span class="badge rounded-pill" style="background: linear-gradient(135deg, #CD7F32, #A0522D); color: white; font-size: 1.1rem; padding: 0.5rem 0.9rem;">
                    ðŸ¥‰ #3
                  </span>
                {% elif loop.index <= 10 %}
                  <span class="badge bg-primary rounded-pill" style="font-size: 1rem; padding: 0.4rem 0.8rem;">
                    #{{ loop.index }}
                  </span>
                {% else %}
                  <span class="badge bg-secondary rounded-pill">
                    #{{ loop.index }}
                  </span>
                {% endif %}
              </td>
              <td class="align-middle">
                {% if chair.profile_image %}
                  <img src="{{ url_for('profile_image', user_id=chair.id) }}" 
                       alt="{{ chair.display_name }}" 
                       class="rounded-circle" 
                       style="width: 45px; height: 45px; object-fit: cover; border: 2px solid #dee2e6;">
                {% else %}
                  <div class="rounded-circle d-flex align-items-center justify-content-center bg-secondary" 
                       style="width: 45px; height: 45px;">
                    <i class="fas fa-user text-white"></i>
                  </div>
                {% endif %}
              </td>
              <td class="align-middle">
                <strong>{{ chair.display_name }}</strong>
              </td>
              <td class="align-middle">
                <code class="text-muted">BP-{{ 1000 + chair.id }}</code>
              </td>
              <td class="align-middle">
                <small class="text-muted">{{ chair.email }}</small>
              </td>
              <td class="text-center align-middle">
                <span class="badge bg-info rounded-pill">
                  {{ chair.total_meetings }} meetings
                </span>
              </td>
              <td class="text-center align-middle">
                {% if loop.index <= 3 %}
                  <span class="badge rounded-pill" 
                        style="background: linear-gradient(135deg, #28a745, #20c997); font-size: 1.3rem; padding: 0.7rem 1.2rem;">
                    ðŸª™ {{ chair.chair_points }}
                  </span>
                {% else %}
                  <span class="badge rounded-pill bg-success" style="font-size: 1.1rem; padding: 0.5rem 1rem;">
                    ðŸª™ {{ chair.chair_points }}
                  </span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="text-center py-5">
        <i class="fas fa-trophy fa-4x text-muted mb-3"></i>
        <h4 class="text-muted">No ChairPoints Awarded Yet</h4>
        <p class="text-muted">ChairPoints will appear here as chairpersons complete meetings.</p>
      </div>
      {% endif %}
    </div>
    <div class="card-footer text-center bg-light">
      <small class="text-muted">
        <i class="fas fa-info-circle"></i> 
        ChairPoints are automatically awarded daily at 1:00 AM for meetings completed the previous day.
        Each meeting chaired = 1 ChairPoint. Historical points are backfilled when users register.
      </small>
    </div>
  </div>

  <!-- Legend -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-dark text-white">
          <h5 class="mb-0"><i class="fas fa-question-circle"></i> How ChairPointsâ„¢ Work</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <h6><i class="fas fa-star text-warning"></i> Earning Points</h6>
              <ul>
                <li>Earn <strong>1 ChairPoint</strong> for each meeting you chair</li>
                <li>Points are awarded automatically daily at <strong>1:00 AM</strong></li>
                <li>Historical meetings are counted when you first register</li>
                <li>Points accumulate over time - the more you serve, the higher you climb!</li>
              </ul>
            </div>
            <div class="col-md-6">
              <h6><i class="fas fa-trophy text-warning"></i> Recognition Levels</h6>
              <ul>
                <li>ðŸ¥‡ <strong>1st Place</strong> - Top contributor (Gold Medal)</li>
                <li>ðŸ¥ˆ <strong>2nd Place</strong> - Runner-up (Silver Medal)</li>
                <li>ðŸ¥‰ <strong>3rd Place</strong> - Third place (Bronze Medal)</li>
                <li>ðŸŒŸ <strong>Top 10</strong> - Elite group of dedicated chairs</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
/* Sticky header for scrolling */
.sticky-top {
  position: sticky;
  top: 0;
  z-index: 10;
}

/* Smooth hover effects */
.table-hover tbody tr:hover {
  background-color: rgba(255, 215, 0, 0.1);
  transform: scale(1.01);
  transition: all 0.2s ease;
}

/* Top 3 highlight */
.table-warning {
  background-color: rgba(255, 215, 0, 0.15) !important;
}

/* Print styles */
@media print {
  /* Hide non-essential elements */
  .btn-group, 
  .card-footer,
  nav,
  footer,
  .navbar {
    display: none !important;
  }
  
  /* Remove sticky positioning */
  .sticky-top {
    position: static;
  }
  
  /* Optimize page layout */
  body {
    margin: 0;
    padding: 0;
    background: white !important;
  }
  
  .container-fluid {
    width: 100%;
    max-width: 100%;
    padding: 0;
  }
  
  /* Ensure card displays properly */
  .card {
    border: 1px solid #000 !important;
    box-shadow: none !important;
    page-break-inside: avoid;
  }
  
  .card-header {
    background: #FFD700 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    color: #000 !important;
    border-bottom: 2px solid #000;
  }
  
  /* Ensure table is readable */
  .table {
    font-size: 10pt;
    width: 100%;
  }
  
  .table thead {
    background: #f8f9fa !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
  
  .table-striped tbody tr:nth-of-type(odd) {
    background-color: #f9f9f9 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
  
  /* Preserve badge colors */
  .badge {
    border: 1px solid #000;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
  
  /* Print top 3 highlighting */
  .table-warning {
    background-color: #fff9e6 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
  
  /* Ensure images print */
  img {
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
  
  /* Page break control */
  .card {
    page-break-after: avoid;
  }
  
  thead {
    display: table-header-group;
  }
  
  tr {
    page-break-inside: avoid;
  }
  
  /* Summary cards - make them print in a row */
  .row.mb-4:first-of-type {
    display: flex !important;
    flex-wrap: nowrap !important;
  }
  
  .row.mb-4:first-of-type .col-md-3 {
    flex: 1;
    padding: 5px;
  }
  
  .row.mb-4:first-of-type .card {
    font-size: 9pt;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
  
  /* Adjust margins for better printing */
  h2, h4 {
    margin-top: 10px;
    margin-bottom: 10px;
  }
  
  .mb-4 {
    margin-bottom: 10px !important;
  }
  
  .py-4 {
    padding-top: 10px !important;
    padding-bottom: 10px !important;
  }
}
</style>
{% endblock %}
