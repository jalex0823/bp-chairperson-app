{% extends "base.html" %}
{% block content %}
  <h2>Reset Sponsor Password</h2>

  <p class="text-muted" style="max-width: 520px;">
    Enter the email address for your sponsor portal account. After you submit, youâ€™ll get a one-time reset link right here (no email required).
  </p>

  <form method="post" action="{{ url_for('sponsor_forgot_password') }}" class="mt-3" style="max-width: 420px;" autocomplete="on">
    {{ form.hidden_tag() }}

    <div class="mb-3">
      {{ form.email.label(class="form-label") }}
      {{ form.email(class="form-control",
                    type="email",
                    autocomplete="username",
                    autocapitalize="none",
                    autocorrect="off",
                    spellcheck="false",
                    inputmode="email",
                    enterkeyhint="send",
                    placeholder="your.email@example.com") }}
    </div>

    {{ form.submit(class="btn btn-primary w-100") }}
    <div class="form-text mt-2">
      Tip: Treat the reset link like a temporary password. Anyone with the link can reset your sponsor password.
    </div>
  </form>

  {% if reset_url %}
    <div class="card mt-3" style="max-width: 720px;">
      <div class="card-body">
        <div class="mb-2"><strong>Reset link</strong></div>
        <div class="input-group">
          <input id="resetLink" type="text" class="form-control" value="{{ reset_url }}" readonly>
          <button id="copyResetLink" class="btn btn-outline-secondary" type="button">Copy</button>
          <button id="shareResetLink" class="btn btn-outline-secondary" type="button" style="display:none;">Share</button>
        </div>
        <div class="form-text mt-2">
          Tip: On iPhone/iPad, tap <strong>Share</strong> to save it to Notes or send via Messages.
        </div>
      </div>
    </div>

    <script>
      (function() {
        const input = document.getElementById('resetLink');
        const copyBtn = document.getElementById('copyResetLink');
        const shareBtn = document.getElementById('shareResetLink');

        if (shareBtn && navigator && navigator.share) {
          shareBtn.style.display = '';
        }

        if (copyBtn && input) {
          copyBtn.addEventListener('click', async function() {
            try {
              await navigator.clipboard.writeText(input.value);
              copyBtn.textContent = 'Copied';
              setTimeout(() => { copyBtn.textContent = 'Copy'; }, 1500);
            } catch (e) {
              input.focus();
              input.select();
              document.execCommand('copy');
            }
          });
        }

        if (shareBtn && input) {
          shareBtn.addEventListener('click', async function() {
            try {
              await navigator.share({
                title: 'Back Porch Sponsor Password Reset',
                text: 'Use this link to reset your Back Porch sponsor password:',
                url: input.value
              });
            } catch (e) {
              // user cancelled
            }
          });
        }
      })();
    </script>
  {% endif %}

  <p class="mt-3">
    <a href="{{ url_for('sponsor_login') }}">Back to sponsor login</a>
  </p>
{% endblock %}

