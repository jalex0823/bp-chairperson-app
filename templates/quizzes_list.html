{% extends 'base.html' %}
{% block content %}
<div class="container py-4">
  
  <!-- Flash Messages with Better Visibility -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show mb-4" role="alert" style="color: white; font-weight: 500;">
          {% if category == 'warning' %}
            <i class="fas fa-exclamation-triangle"></i>
          {% elif category == 'success' %}
            <i class="fas fa-check-circle"></i>
          {% elif category == 'danger' %}
            <i class="fas fa-times-circle"></i>
          {% else %}
            <i class="fas fa-info-circle"></i>
          {% endif %}
          {{ message }}
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}
  
  <!-- Header -->
  <div class="row mb-4">
    <div class="col-12">
      <h1 class="mb-2"><i class="fas fa-graduation-cap"></i> Training Quizzes</h1>
      <p class="text-muted">Complete these training quizzes to earn ChairPoints and improve your skills!</p>
    </div>
  </div>

  <!-- Quiz Cards -->
  <div class="row">
    {% for quiz_id, quiz in quizzes.items() %}
    <div class="col-md-6 mb-4">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <h4 class="card-title mb-0">
              <i class="fas fa-video text-primary"></i> {{ quiz.title }}
            </h4>
            {% if attempts[quiz_id] %}
            <span class="badge bg-success">
              <i class="fas fa-check"></i> Completed
            </span>
            {% else %}
            <span class="badge bg-warning text-dark">
              <i class="fas fa-clock"></i> Not Started
            </span>
            {% endif %}
          </div>
          
          <p class="card-text text-muted">{{ quiz.description }}</p>
          
          <div class="mt-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <small class="text-muted">
                <i class="fas fa-question-circle"></i> {{ quiz.questions|length }} questions
              </small>
              <small class="text-success">
                <img src="{{ url_for('static', filename='img/chairpoint-coin.png') }}" style="width: 20px; height: 20px; vertical-align: middle;" alt="ChairPoints"> <strong>50 ChairPoints</strong>
              </small>
            </div>
            
            {% if attempts[quiz_id] %}
            <div class="alert alert-success mb-2" style="background: linear-gradient(135deg, #28a745 0%, #20833a 100%); border: none; color: white; font-weight: 500;">
              <i class="fas fa-trophy" style="color: #ffd700;"></i> 
              <strong style="color: white;">Score: {{ attempts[quiz_id].score }}%</strong>
              <span style="color: rgba(255,255,255,0.95);">({{ attempts[quiz_id].correct_answers }}/{{ attempts[quiz_id].total_questions }} correct)</span>
              <br>
              <small style="color: rgba(255,255,255,0.9);">Completed: {{ attempts[quiz_id].completed_at.strftime('%B %d, %Y at %I:%M %p') }}</small>
            </div>
            {% endif %}
            
            <div class="d-grid gap-2">
              <a href="{{ url_for('quiz_view', quiz_id=quiz_id) }}" class="btn btn-primary">
                {% if attempts[quiz_id] %}
                <i class="fas fa-eye"></i> Review Quiz
                {% else %}
                <i class="fas fa-play"></i> Start Quiz
                {% endif %}
              </a>
              
              {% if attempts[quiz_id] %}
              <a href="{{ url_for('quiz_certificate', user_id=current_user.id) }}" 
                 class="btn btn-outline-success" target="_blank">
                <i class="fas fa-certificate"></i> Download Certificate
              </a>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Instructions -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card" style="background-color: #f8f9fa !important; border: 1px solid #dee2e6;">
        <div class="card-body">
          <h5 style="color: #0f6f75;"><i class="fas fa-info-circle text-info"></i> How It Works</h5>
          <ol class="mb-0" style="color: #212529;">
            <li>Watch the instructional video carefully</li>
            <li>Complete the quiz (you need 70% or higher to pass)</li>
            <li>Earn 50 ChairPoints upon passing each quiz</li>
            <li>You can retake quizzes, but points are only awarded once</li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <!-- Back Button -->
  <div class="row mt-4">
    <div class="col-12">
      <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      </a>
    </div>
  </div>

</div>

<style>
.card {
  transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 16px rgba(0,0,0,0.15) !important;
}

/* Brighten alert messages for better readability */
.alert-warning {
  background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%) !important;
  border: none !important;
  color: white !important;
  text-shadow: 0 1px 2px rgba(0,0,0,0.2);
}

.alert-warning strong {
  color: white !important;
}

.alert-success {
  background: linear-gradient(135deg, #28a745 0%, #20833a 100%) !important;
  border: none !important;
  color: white !important;
}

.alert-danger {
  background: linear-gradient(135deg, #dc3545 0%, #bd2130 100%) !important;
  border: none !important;
  color: white !important;
}

.alert-info {
  background: linear-gradient(135deg, #17a2b8 0%, #138496 100%) !important;
  border: none !important;
  color: white !important;
}

/* Ensure icons are visible */
.alert i {
  color: white !important;
  opacity: 0.95;
}
</style>
{% endblock %}
